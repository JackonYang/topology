topology
========

画拓扑图

核心流程
--------

#### 数据获取

- 输入：islandId 和 当前url.  
    根据当前URL判断是生产环境/测试环境，拓扑图的类型为设备拓扑/slice拓扑。  
    生产环境使用 AJAX，测试环境除 AJAX，也可以直接读取本地文件。  
    根据 islandId 取数据。
- 输出：图的节点和节点间连接关系。  
    节点和连接各种一个 dict 存储，key 为节点/连接类型。  
    节点的 value 为 Object, key 存id, value 存 详细信息string。  
    连接的 value 为集合，集合的每一个元素是[from, to],

#### 生成树。

- 输入: 图，包含节点和连接信息。
- 输出：各类节点的分层关系。

#### 确定每一棵树的画布参数
    

#### 计算节点坐标

根据树的画布参数，计算该树各节点的坐标信息。

#### 生成 html。

- 输入: 节点坐标，节点的长宽。
- 输出：html

线的坐标，根据节点坐标自动计算。

尺寸计算
------------

#### 计算原则

1. 理想情况下，可以在一个屏幕内看到完整的拓扑图，不管设备节点的数量有多少。
2. 如果节点数量较少，则缩小画布大小以适应拓扑图，避免上下留白。
3. 如果节点数量过多，无法用最佳尺寸在一个屏幕内展示完整图片，则压缩尺寸。
4. 如果尺寸压缩到最小的极限长度，则调整画布大小，支持鼠标滚动来看到完整的拓扑图。

#### 参数确定

- 屏幕大小: 900px * 540px (5:3)
- 图片大小: 120px * 120px (1:1)
- 行间距: 1 倍图片高度
- 行内节点最小间距: 0
- 行内节点最大间距: 1 倍图片距离
